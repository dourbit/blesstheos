#!/usr/bin/env bash

# uses curl-report to download something and make it executable
# at a given filepath as a 1st arg, the rest of args being same as curl-report
# this was started as some downloads fail and thus installs become unpredictable

main() {
  if [ $# -lt 2 ]; then
    echo "Usage: $(basename $0) <filepath> <url> [curl-options]"
    false; return
  else
    local FILEPATH=${1}
    local SAVE_DIR=$(dirname ${FILEPATH})
    local FILENAME=$(basename ${FILEPATH})
    local RELOCATE=${SAVE_DIR}/${FILENAME}
    if curl-report ${@:2} --create-dirs -o ~/tmp/${FILENAME}; then
      chmod +x ~/tmp/${FILENAME} && mkdir -p ${SAVE_DIR}
      if [ ! ~/tmp/${FILENAME} -ef ${RELOCATE} ]; then
        mv ~/tmp/${FILENAME} ${RELOCATE}
      fi
      echo "Located:"
      echo "$(ls -l ${RELOCATE})"
      true; return
    elif [ -f ~/tmp/${FILENAME} ]; then
      rm ~/tmp/${FILENAME}
      false; return
    fi
  fi
}

main "$@"
