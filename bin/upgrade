#!/usr/bin/env bash

sudoUse

if check-x brew; then
  specho Homebrew ...
  brew upgrade
fi

if onLinux && check-x apt; then
  specho Apt ...
  sudo apt -y upgrade
fi

[ -s $NVM_DIR/nvm.sh ] && . $NVM_DIR/nvm.sh
if check-x nvm; then
  specho NVM ...
  nvm-up
  if check-x bb; then
    specho NodeJS ...
    node-up
  else
    specho "Babashka required, please install/shell"
  fi
fi

if check-x lein; then
  specho Leiningen ...
  if sudo-fn check-x lein; then
    # global lein needs sudo to upgrade
    yes Y | sudo lein upgrade
  else
    # sometimes lein install is just within a local user context
    yes Y | lein upgrade
  fi
  specho Leiningen User Profiles ...
  lein ancient upgrade-profiles ~/.lein/profiles.clj 2>/dev/null
fi

# Some things may not have been installed with brew...
if ! brewOn; then
  if check-x bb; then
    specho Babashka ...
    sudomy gh-install-xr borkdude/babashka install ~/tmp/
  fi
  if check-x clj-kondo; then
    specho Clj-kondo ...
    sudomy gh-install-xr borkdude/clj-kondo script/install-clj-kondo ~/tmp/
  fi
fi
